# モデルに命を与える
## 5.1 モデルの役割
### 5.1.1 モデルとActiveRecord
#### Bookモデルがある時
Book < ApplicationRecord < ActiveRecord::Base
といった継承関係にある。
#### できること
- 親クラスのメソッドを使用できる
#### これまでの捉え方との違い
これまでは、なんだかわからないが`Book.new(title: "タイトル", text: "本の感想です。")`とするだけで、
データを新規登録するための準備ができ、saveメソッドでデータベースに保存される。とだけ考えていた。

しかし、実際はBookクラスに初期値を与え、インスタンス化していた。  
findやallメソッドもインスタンス化していたことを知った。  
また、titleなども値を定義して代入しているだけだと思っていたが、実際は同じ名前でメソッドが内部的に定義されており、  
インスタンスした後にbook.titleという形のインスタンスメソッドとして扱っていたことを知った。

#### ActiveRecordの役割
データベースのテーブルとモデルの関係付けを行う役割を担っている。
そして、一般的にそのような役割を担う仕組みをORM(オブジェクト・リレーショナル・マッピング)という。
SQL文はデータベースごとに方言があり、それを変換する仕事をしている。
具体的には、データベースを処理するためのモデルのメソッドを呼び出すと、利用しているデータベースのSQL文に変換され、テーブルに対してSQL文が実行される。  
ActiveRecord(ORM)があるため、データベースが違っても、SQL文の形式や文法の違いを考えることなく同じメソッドを使用して同じy方に処理ができる。

ActiveRecordは、1レコードに対して、1モデルのインスタンスとして生成する。  
そして、テーブルのカラムの名前と同じメソッドを使って、インスタンスが持つ属性とやり取りする。  
例えば、  
Bookモデルのtitle属性は、  
booksテーブルのtitleカラムに対応しており、  
Bookモデルのインスタンスは、titleメソッドを使用して、タイトルの値を取得できる。

#### 練習問題 5.1
1. ActiveRecordとORMの関係について説明してください。
  - 解答
    同じ役割を担う仕組み。ActiveRecordはRailsにおけるORMである。  
    具体的にORMとはオブジェクト・リレーショナル・マッピングの略称で、モデルとデータベースを関係付ける役割を担う。  
    モデルでのデータベースへの操作をSQL文に変換して処理を行う。  
    SQL文は、データベースごとに方言があるため、使用データベースごとに変更する必要があるが、ORMがそれをやってくれる。
  - 正解
    正解
2. モデルに定義した属性は、どこにどのように実装されているか説明してください。
  - 解答
    モデルに定義した属性は、テーブルのカラムに保存される。  
    それらはモデルのインスタンス化により、インスタンスメソッドとして定義され、呼び出すことで表示させることができる。
  - 正解
    正解
3. モデルの属性の値を取得する場合、どのように行うのかを説明してください。
  - 解答
    モデルの属性の値を取得するには、インスタンス化して属性名と同じ名前のインスタンスメソッドで呼び出すことができる。
  - 正解
    モデルインスタンスの「項目名と同名のメソッド」で、テーブルに登録された値を取得できる。
4. モデルに実装される機能には、どのようなものがあるか例示してください。
  - 解答
    CRUD機能、バリデーション
  - 正解
    データリソースのライフサイクルを実現する機能  
    データリソースの個々の属性の正当性を保証し、正常に保つ機能  
    データリソースの処理の対象範囲を制御する機能  
    モデル同士の相互の関係を適切に保つ機能  
    データリソース内の整合性を保証する機能  
    データリソースをよりスマートに管理する機能  


## 5.2 モデルの作成

### 5.2.1 モデルの作成手順とモデル生成
1. 対象となるモデルを生成する
2. マイグレーションを行い、モデルに対応するテーブルを作成する
3. モデルの基本の検証を行う
4. 動作検証に基づいて、モデルに必要な機能を追加する

- 予想
1. rails g model book title:string text:text
2. rails db:migrate
3. ??
4. ??

- 答え
1. rails cでデータを登録したり、allメソッドetcで検証する。

#### モデル名のルール
- キャメル形式  
  UserAddress
- スネーク形式  
  user_address
- コマンド入力時のモデル名  
  英小文字単数 book user_address
- 生成モデル名  
  先頭大文字キャメル形式 単数形 Book UserAddress
- 生成テーブル名  
  英小文字複数形 books user_addresses

#### 属性のオプション
モデルの属性に対して、:で続けて記述することでオプションをつけることができる。  
例：userモデルのemailは重複しないデータにしたい場合。
```bash
$ rails g user name:string email:string:uniq
```

例：対象の属性をインデックスキーとして使用するためのオプション
```bash
$ rails g user name:string number:integer:index
```

#### 練習問題 5.2
1. モデルの生成時に自動で付与される属性を列挙し、それぞれの役割を説明してください。
  - 解答
    - 主キー
      検索用に自動付与されるinteger型の属性
    - 生成日時(created_at)
      生成日時をdate型で記録する属性
    - 更新日時(updated_at)
      更新日時をdate型で記録する属性

  - 正解


## 5.3 マイグレーションとシード機能
## 5.4 CRUD操作と標準装備のメソッド
## 5.5 まとめ