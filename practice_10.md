# Action View
Railsにおけるビューの機能を扱うコンポーネント

## HTMLとERBテンプレート
### 学習前 練習問題10.1
1. ビューテンプレートにRubyコードを組み込む際に使う、<% 〜 %>と<%= 〜 %>という2つの方法の違いについて説明してください。  
  HTMLとして表示しない場合は=を入れない。HTMLとして表示させたい場合は、=をつける。  
2. ビューテンプレートのコメントアウトについて、<!-- 〜 -->と<%#= 〜 %>の違いについて説明してください。  
  わからない。

<%=%>これは実行された結果をHTMLに組み込んでHTTPレスポンスのデータとして出力したい場合に使う。

### ERBにおけるRubyのコメントアウト
`<%#= コメント %>`

### 複数業を一括してコメントアウト
1. Rubyの条件分として、一括して`<% if false %> ~ <% end %>`のように囲む
2. =beginと=endで囲む

```ruby
<%
=begin
%>
comment.comment.comment.comment.comment.comment.
comment.comment.comment.comment.comment.comment.
<%
=end
%>
```

> `<!---->`だとhtmlには変換されるので、ソースコードから見れる。

### 特殊文字をエスケープさせない方法
1. <%== 文字列/式 %>のように、2つの=を使う。
2. <%= raw(文字列/式) %>のように、rawメソッドを使う。
3. <%= 文字列/式.html_safe %>のように、html_safeメソッドを使う。

### 学習後 練習問題10.1
1. ビューテンプレートにRubyコードを組み込む際に使う、<% 〜 %>と<%= 〜 %>という2つの方法の違いについて説明してください。  
  - 解答  
    HTMLを生成し、表示したい場合に=を使う。
  - 正解  
    実行された結果をHTMLに組み込んでHTTPレスポンスのデータとして出力したい場合に使う。

1. ビューテンプレートのコメントアウトについて、<!-- 〜 -->と<%#= 〜 %>の違いについて説明してください。  
  - 解答  
    `<!-- comment -->`は、HTMLにおいてのコメントアウト。`<%#= comment %>`はERBにおけるRubyのコメントアウト。
  - 正解
    正解

## レイアウト
### 学習前 練習問題 10.2
1. 個別のレイアウトを指定する場合の、方法とルールを説明してください。
- **解答**  viewsファイルのアクションに相当するビューファイルを編集する。HTMLを使用する。
2. レイアウトを設定する際の、content_forの目的と実際の使い方を具体的に説明してください。
- **解答**  わかりません。

### 大前提
Action Viewは全体で共通するフレームデザインなどを設けており、メインページのみをそれぞれのアクションに対応するように書き換えることで、統一感を出しながら、管理しやすくしている。

### レイアウトの役割
表示するHTMLページの、共通な外枠フレームの部分を切り出して分離することで、共通部分の保守管理を簡単にすること、および統一感、一貫性のあるページ表現構成を実現する役割がある。

#### headタグにある`csrf_meta_tags`について
セキュリティトークンを追加するヘルパーメソッド。  
正当なクライアントか確認するための認証チケット。  
クロスサイトリクエストフォージェリ攻撃対策用に、自動的に挿入される。  

### 動的なレイアウト機構(content_for)
> Rails の **DRY** の原則に則る。

=> Libraryアプリケーションにて実装

### 練習問題10.2
1. 個別のレイアウトを指定する場合の、方法とルールを説明してください。
- **解答**  layoutsディレクトリにコントローラー名単数で拡張子はhtml.erbで作成する。
- **正解**  正解。
1. レイアウトを設定する際の、content_forの目的と実際の使い方を具体的に説明してください。
- **解答**  目的はRailsのDRYの原則を遵守し、重複するコードを減らすため。方法はレイアウトに`<%= yield :名前 %>`とし、それぞれ個別のerbファイルにおいて`content_for :名前`とブロックで囲み、ブロック内にhtmlを記述する。
- **正解**  重複をなくし、より柔軟に動的にレイアウトを適用するために、埋め込みビューの条件に対応するyield機能を使って設定する。


## ビューテンプレートの共通部品管理

### 部分テンプレートの利用

#### Q. 部分テンプレートのメリットは？
- **A.**  テンプレートの共通部分を、重複なく一箇所で管理することができることと、親となるテンプレートを見やすく、シンプルにできる。

#### Q. renderメソッドにpartialオプションをつけるとどうなる？
- **A.**  部分テンプレート（パーシャルテンプレート）となる。

#### Q. 部分テンプレートにおける、partialオプションは通常省略ができるが、省略できない時もある。それはどんな時？
- **A.**  ローカル変数を渡すためのlocalsオプションを指定するとき。

#### Q. 部分テンプレートでは親テンプレートで使用しているインスタンスヘンスがあればそのまま部分テンプレートでもインスタンス変数を使うことができるが、部分テンプレートのローカル変数を使用して渡すのがルールとなっている。これはなぜか？
- **A.** 入れ子構造になると受け渡す情報が見にくくなるためルールとなっている。

#### Q. ローカル変数とlocalsオプションは何が違うか？
- **A.** 同じもの。明示的にlocalsオプションを指定したい場合は、partialオプションも明示的に記述する必要がある。  

```ruby
<%= render "users/form",user: @user %>
# 上記と下記は同じ
<%= render partial "users/form",locals: { user: @user } %>
```

#### Q. 部分テンプレートのcollectionオプションは何ができるか？
- **A.** 部分テンプレートの対象となるオブジェクトがインスタンス配列（複数のリソース[例：booksなど]）の場合、配列内の各要素を、`each`メソッドを使わずに一行で記述できる。

#### Q. 部分テンプレートにおけるcollectionオプションの具体的な記述方法は？
- **A.** `<%= render partial "rentals/rental", collection: @book.rentals %>`  
rentalsディレクトリに部分テンプレート`_rental.html.erb`ファイルがあることが前提。

#### Q. 上記のcollectionオプションによる記述方法のもっと簡略化した記述方法は？
- **A.** `<%= render partial: @book.rentals %>`  
上記のコードは部分テンプレート名を省略することで、自動的に部分テンプレートと受け取るローカル変数が決定され、処理が行われる。  
例えば、@book.rentalsのインスタンス配列を提供するメソッドはrentalsという名前だが、その単数系rentalを使用して、部分テンプレートが_rental.html.erb、受け取るローカル変数名がrentalと自動的に決定される。

## ビューヘルパー
### 練習問題 10.4
1. image_tagを使用して画像を表示する場合、相対パスと絶対パスで指定する場合の画像の保存場所の違いを説明してください。  
A. わからない。
2. form_withヘルパーメソッドの役割およびmodelオプションとscopeオプションの使い方の違いを具体的に説明してください。  
A. わからない。
3. fields_forヘルパーメソッドの使い方について説明してください。また、その時のストロングパラメーターとの関係についても説明してください。  
A. わからない。
