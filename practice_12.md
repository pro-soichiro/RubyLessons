# 12 その他のコンポーネント
## 12.1 Active Mailer
まとめ問題
### Q. Action Mailerの役割について説明してください。
- **A.** Railsアプリケーションで電子メールの送受信を行うための標準コンポーネント。
### Q. メーラーとコントローラーの関係について説明してください。
- **A.** コントローラーがWeb情報の送受信を制御する役割を持つのに対して、メーラーは電子メールの送受信を制御する役割を持つ。
### Q. メーラーの起動方法について説明してください。
- **A.** コントローラーのアクション内で、メーラークラスとメソッドを指定してメーラーを呼び出す。  
`(メーラークラス名).(メソッド).deliverメソッド`  
NoticeMailerクラスのgreetingアクションであれば、`NoticeMailer.greeting.deliver_now`  
deliverメソッドに関しては、即時配信の`now`とActive Jobによって非同期配信する`later`がある。
### Q. メールサーバーを設定せずに、メール送信のみを確認する方法について説明してください。
- **A.** `config.action_mailer.deliver_method = :test`とする。
### Q. メール受信を実装するために必要な要件を説明してください。
- **A.** ポーリングジョブの作成と起動、および受信メーラーの作成と起動が必要。  
それぞれの役割としては、ポーリングジョブは定期的に受信メールサーバーを監視し、メールがあれば転送する役割があり、受信メーラーにはreceiveメソッドでメールが転送され受け取る役割がある。

## 12.2 Active Storage
### 使用手順
1. Active Storageテーブル作成のための、マイグレーションのインストールと実行
  
  ```bash
  $ rails active_storage:install
  $ rails db:migrate
  ```

2. 対象モデルに`has_one_attached/has_many_attached`メソッドを使用し、画像などの対象リソースのアソシエーション設定を行う。
3. 対象モデルのコントローラーのストロングパラメーターにアソシエーション設定を行った属性名を追加する。

### Q. ActiveStorageの役割について説明してください。
- **解答** 画像やファイルなどを保存させられるストレージ
- **正解** 正解
### Q. あるモデルに対応するデータリソースに画像を属性として追加する場合、ActiveStorageでは、どのような設定が必要になるか、2種類の場合を想定して説明してください。
- **解答** モデルに`has_one/many_attached`で属性名でアソシエーションを行う。複数保存させたい場合には、ストロングパラメーターに画像であれば、`images: []`とし、一つのサンプルなどであれば、`sample:`とする。あとは、viewにおいてfile_fieldで参照、image_tagメソッドを使用し、表示する。
- **正解** モデル間のアソシエーションと類似した方法で画像などを結びつける。  
モデルに対して、1対1か1対多の関係という2種類の方法がある。
### Q. ストレージの保存場所を変更する場合の方法について説明してください。
- **解答** config/storage.ymlにて設定可能。
- **正解** 正解ではあるが、config/environmentsディレクトリ内の環境設定ファイルにおける、`config.active_storage.service`の設定によって変えられる。


## 12.3 そのほかの有用な機能
### Q. ActiveJobの役割について説明してください。
- **A.** 月末や締めの単位で請求書を一括して作成したり、ゴミとみなされるような情報を定期的に掃除したりするために、通常のWebアプリケーションと切り離して（非同期で）処理する仕組み
### Q. ジョブの起動方法について、2つの方法を説明してください。
- **A.** コントローラーのアクションか、rails runnerコマンド
### Q. Webソケットを使用した、双方向通信ができるRailsのコンポーネントについて説明してください。
- **A.** Action Cableは、チャットのような双方向のリアルタイム機能をRailsのフレームワークの中で実現する機能
### Q. Action Cable に必要な仕組みについて概要を説明してください。
- **A.** クライアントのブラウザーに組み込まれたチャンネル制御用のJavaScriptプログラムとサーバー側のチャンネルが、WebSocketを通してやりとりをする。
### Q. 新しいGemパッケージを追加する場合の手順を説明してください。
Gemfileに設定し、bundle installしてRailsアプリケーションに組み込む。
